{% extends "layout.twig" %}

{% block title %}
Weak ordering graph of coxeter group $W = {{ group.name | default('-') }}$ with automorphism $\theta = 
{% for transposition in automorphism.transpositions %}
    (s_{{ transposition[0] }} s_{{ transposition[1] }})
{% else %}
    \textrm{id}
{% endfor %}
$
{% endblock %}

{% block content %}
<div id="canvas" style="border: 1px solid #ddd; background-color: #fff; overflow: auto; max-height: 400px;"></div>
<script type="text/javascript">
$(function () {
    $.ajax('/weakordering/{{ group.id }}/{{ automorphism.id }}/graph.json', {
        'dataType': 'json',
        'method': 'GET',
        success: function (data) {
            if (data === false) {
                $('#canvas').html('Weak ordering has not been calculated yet!');
                return;
            }
            
            var generators = data[0];
            var vertices = data[1];
            var edges = data[2];
            
            var graph = new Graph($('#canvas')[0], 100, 100);
            var levels = {};
            var size = [0, 0];
            
            $.each(vertices, function(i, v) {
                if (!levels[v[1]]) {
                    levels[v[1]] = 0;
                }

                var vertex = graph.addVertex(v[0], { label: v[0].replace(/[\*|s]/g, '') });
                vertex.positionX = levels[v[1]]++;
                vertex.positionY = v[1];

                if (size[0] < levels[v[1]]) size[0] = levels[v[1]];
                if (size[1] < v[1]) size[1] = v[1];
            });
            $.each(edges, function(i, e) {
                graph.addEdge(vertices[e[0]][0], vertices[e[1]][0], { label: e[2] });
            });
            
            graph.width = size[0] * 150;
            graph.height = size[1] * 150;
            graph.scale = new GraphScale.Linear(-1, size[0], -1, size[1] + 1, graph.width, graph.height);
            
            console.log(levels);
            console.log(graph);
            graph.draw();
        },
        error: function (err) {
            alert(err);
        }
    });
});
</script>
{% endblock %}